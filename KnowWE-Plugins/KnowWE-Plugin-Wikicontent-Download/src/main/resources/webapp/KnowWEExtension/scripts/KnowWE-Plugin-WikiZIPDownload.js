(function(i,Q){"use strict";var V=document.createElement("style");V.textContent=`.snapshots-panel{display:inline-block;border-radius:.75rem;border:1px solid #000000;padding:1rem;min-width:35rem}.snapshots-panel h3{padding:0;margin:0}.popup-content{margin:auto;background:#fff;width:50%;padding:5px;border:1px solid #d7d7d7}[role=tooltip].popup-content{width:200px;box-shadow:0 0 3px #00000029;border-radius:5px}.popup-overlay{background:#00000080}[data-popup=tooltip].popup-overlay{background:transparent}.snapshots-popup-content{width:auto;max-width:640px;padding:0;border-radius:.125rem}.snapshots-popup-content header{margin:0;padding:.5rem 1rem;font-weight:700;color:var(--text-color-default-head);background-color:var(--bg-color-table-th-highlighted)}.snapshots-popup-content main{padding:1rem 2rem .5rem}.snapshots-popup-content form{display:flex;flex-direction:column;font-size:.9rem}.snapshots-popup-content footer{margin-top:1rem;display:flex;flex-direction:row;justify-content:center;gap:.5rem}.snapshots-popup-content button{font-size:.9rem}.snapshots-popup-content button[disabled]{color:gray}.snapshots-popup-content .btn-danger{color:var(--text-color-error)}.snapshots-popup-content ul{margin:0}.snapshots-popup-content input{margin-left:.5rem}.versioning-spinner{display:inline-block;width:2rem;height:2rem;border-radius:50%;border:.25em solid #0d6efd;border-right-color:transparent;-webkit-animation:.75s linear infinite spinner;animation:.75s linear infinite versioning-spinner}@keyframes versioning-spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.snapshots-table{border:1px solid #ddd;border-collapse:collapse;border-spacing:0;width:100%}.snapshots-table td{text-align:left;padding:8px;border:1px solid #000000}.snapshots-table th{border:1px solid #000000}.snapshots-table th:last-child{width:1px;white-space:nowrap}.snapshots-table td:last-child{text-align:center;cursor:pointer}.snapshots-table thead tr:first-child{background-color:#bbb}.snapshots-table tbody tr:nth-child(2n){background-color:#f2f2f2}.snapshots-table button{padding:.125rem .5rem}
/*$vite$:1*/`,document.head.appendChild(V);var Y={exports:{}},D={};var Z;function Pe(){if(Z)return D;Z=1;var e=i,t=Symbol.for("react.element"),o=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,l=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(b,a,c){var u,h={},v=null,f=null;c!==void 0&&(v=""+c),a.key!==void 0&&(v=""+a.key),a.ref!==void 0&&(f=a.ref);for(u in a)r.call(a,u)&&!d.hasOwnProperty(u)&&(h[u]=a[u]);if(b&&b.defaultProps)for(u in a=b.defaultProps,a)h[u]===void 0&&(h[u]=a[u]);return{$$typeof:t,type:b,key:v,ref:f,props:h,_owner:l.current}}return D.Fragment=o,D.jsx=p,D.jsxs=p,D}var B;function Ae(){return B||(B=1,Y.exports=Pe()),Y.exports}var n=Ae(),I={},ee;function Ne(){if(ee)return I;ee=1;var e=Q;return I.createRoot=e.createRoot,I.hydrateRoot=e.hydrateRoot,I}var te=Ne();function $(){return $=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},$.apply(this,arguments)}var Le=function(t,o){o===void 0&&(o=!0),i.useEffect(function(){if(o){var r=function(d){d.key==="Escape"&&t(d)};return document.addEventListener("keyup",r),function(){o&&document.removeEventListener("keyup",r)}}},[t,o])},Te=function(t,o){o===void 0&&(o=!0),i.useEffect(function(){if(o){var r=function(){t()};return window.addEventListener("resize",r),function(){o&&window.removeEventListener("resize",r)}}},[t,o])},De=function(t,o,r){r===void 0&&(r=!0),i.useEffect(function(){if(r){var l=function(p){var b=Array.isArray(t)?t:[t],a=!1;b.forEach(function(c){if(!c.current||c.current.contains(p.target)){a=!0;return}}),p.stopPropagation(),a||o(p)};return document.addEventListener("mousedown",l),document.addEventListener("touchstart",l),function(){r&&(document.removeEventListener("mousedown",l),document.removeEventListener("touchstart",l))}}},[t,o,r])},$e=function(t,o){o===void 0&&(o=!0),i.useEffect(function(){if(o){var r=function(d){if(d.keyCode===9){var p,b=t==null||(p=t.current)===null||p===void 0?void 0:p.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),a=Array.prototype.slice.call(b);if(a.length===1){d.preventDefault();return}var c=a[0],u=a[a.length-1];d.shiftKey&&document.activeElement===c?(d.preventDefault(),u.focus()):document.activeElement===u&&(d.preventDefault(),c.focus())}};return document.addEventListener("keydown",r),function(){o&&document.removeEventListener("keydown",r)}}},[t,o])},_e=typeof window<"u"?i.useLayoutEffect:i.useEffect,_={popupContent:{tooltip:{position:"absolute",zIndex:999},modal:{position:"relative",margin:"auto"}},popupArrow:{height:"8px",width:"16px",position:"absolute",background:"transparent",color:"#FFF",zIndex:-1},overlay:{tooltip:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",zIndex:999},modal:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",display:"flex",zIndex:999}}},Re=["top left","top center","top right","right top","right center","right bottom","bottom left","bottom center","bottom right","left top","left center","left bottom"],We=function(t,o,r,l,d){var p=d.offsetX,b=d.offsetY,a=l?8:0,c=r.split(" "),u=t.top+t.height/2,h=t.left+t.width/2,v=o.height,f=o.width,E=u-v/2,j=h-f/2,P="",k="0%",O="0%";switch(c[0]){case"top":E-=v/2+t.height/2+a,P="rotate(180deg)  translateX(50%)",k="100%",O="50%";break;case"bottom":E+=v/2+t.height/2+a,P="rotate(0deg) translateY(-100%) translateX(-50%)",O="50%";break;case"left":j-=f/2+t.width/2+a,P=" rotate(90deg)  translateY(50%) translateX(-25%)",O="100%",k="50%";break;case"right":j+=f/2+t.width/2+a,P="rotate(-90deg)  translateY(-150%) translateX(25%)",k="50%";break}switch(c[1]){case"top":E=t.top,k=t.height/2+"px";break;case"bottom":E=t.top-v+t.height,k=v-t.height/2+"px";break;case"left":j=t.left,O=t.width/2+"px";break;case"right":j=t.left-f+t.width,O=f-t.width/2+"px";break}return E=c[0]==="top"?E-b:E+b,j=c[0]==="left"?j-p:j+p,{top:E,left:j,transform:P,arrowLeft:O,arrowTop:k}},Me=function(t){var o={top:0,left:0,width:window.innerWidth,height:window.innerHeight};if(typeof t=="string"){var r=document.querySelector(t);r!==null&&(o=r.getBoundingClientRect())}return o},Ie=function(t,o,r,l,d,p){var b=d.offsetX,a=d.offsetY,c={arrowLeft:"0%",arrowTop:"0%",left:0,top:0,transform:"rotate(135deg)"},u=0,h=Me(p),v=Array.isArray(r)?r:[r];for((p||Array.isArray(r))&&(v=[].concat(v,Re));u<v.length;){c=We(t,o,v[u],l,{offsetX:b,offsetY:a});var f={top:c.top,left:c.left,width:o.width,height:o.height};if(f.top<=h.top||f.left<=h.left||f.top+f.height>=h.top+h.height||f.left+f.width>=h.left+h.width)u++;else break}return c},Ue=0,ze=function(){var t=document.getElementById("popup-root");return t===null&&(t=document.createElement("div"),t.setAttribute("id","popup-root"),document.body.appendChild(t)),t},F=i.forwardRef(function(e,t){var o=e.trigger,r=o===void 0?null:o,l=e.onOpen,d=l===void 0?function(){}:l,p=e.onClose,b=p===void 0?function(){}:p,a=e.defaultOpen,c=a===void 0?!1:a,u=e.open,h=u===void 0?void 0:u,v=e.disabled,f=v===void 0?!1:v,E=e.nested,j=E===void 0?!1:E,P=e.closeOnDocumentClick,k=P===void 0?!0:P,O=e.repositionOnResize,rt=O===void 0?!0:O,se=e.closeOnEscape,st=se===void 0?!0:se,ie=e.on,R=ie===void 0?["click"]:ie,ae=e.contentStyle,it=ae===void 0?{}:ae,le=e.arrowStyle,q=le===void 0?{}:le,ue=e.overlayStyle,at=ue===void 0?{}:ue,ce=e.className,T=ce===void 0?"":ce,de=e.position,lt=de===void 0?"bottom center":de,pe=e.modal,fe=pe===void 0?!1:pe,he=e.lockScroll,me=he===void 0?!1:he,ve=e.arrow,K=ve===void 0?!0:ve,ye=e.offsetX,ut=ye===void 0?0:ye,be=e.offsetY,ct=be===void 0?0:be,xe=e.mouseEnterDelay,dt=xe===void 0?100:xe,we=e.mouseLeaveDelay,pt=we===void 0?100:we,ge=e.keepTooltipInside,ft=ge===void 0?!1:ge,U=e.children,je=i.useState(h||c),C=je[0],Ee=je[1],S=i.useRef(null),w=i.useRef(null),N=i.useRef(null),ke=i.useRef(null),Ce=i.useRef("popup-"+ ++Ue),g=fe?!0:!r,W=i.useRef(0);_e(function(){return C?(ke.current=document.activeElement,Oe(),yt(),mt()):vt(),function(){clearTimeout(W.current)}},[C]),i.useEffect(function(){typeof h=="boolean"&&(h?z():A())},[h,f]);var z=function(s){C||f||(Ee(!0),setTimeout(function(){return d(s)},0))},A=function(s){var x;!C||f||(Ee(!1),g&&((x=ke.current)===null||x===void 0||x.focus()),setTimeout(function(){return b(s)},0))},J=function(s){s==null||s.stopPropagation(),C?A(s):z(s)},H=function(s){clearTimeout(W.current),W.current=setTimeout(function(){return z(s)},dt)},ht=function(s){s==null||s.preventDefault(),J()},G=function(s){clearTimeout(W.current),W.current=setTimeout(function(){return A(s)},pt)},mt=function(){g&&me&&(document.getElementsByTagName("body")[0].style.overflow="hidden")},vt=function(){g&&me&&(document.getElementsByTagName("body")[0].style.overflow="auto")},yt=function(){var s,x=w==null||(s=w.current)===null||s===void 0?void 0:s.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),m=Array.prototype.slice.call(x)[0];m==null||m.focus()};i.useImperativeHandle(t,function(){return{open:function(){z()},close:function(){A()},toggle:function(){J()}}});var Oe=function(){if(!(g||!C)&&!(!(S!=null&&S.current)||!(S!=null&&S.current)||!(w!=null&&w.current))){var s=S.current.getBoundingClientRect(),x=w.current.getBoundingClientRect(),m=Ie(s,x,lt,K,{offsetX:ut,offsetY:ct},ft);if(w.current.style.top=m.top+window.scrollY+"px",w.current.style.left=m.left+window.scrollX+"px",K&&N.current){var L,M;N.current.style.transform=m.transform,N.current.style.setProperty("-ms-transform",m.transform),N.current.style.setProperty("-webkit-transform",m.transform),N.current.style.top=((L=q.top)===null||L===void 0?void 0:L.toString())||m.arrowTop,N.current.style.left=((M=q.left)===null||M===void 0?void 0:M.toString())||m.arrowLeft}}};Le(A,st),$e(w,C&&g),Te(Oe,rt),De(r?[w,S]:[w],A,k&&!j);var bt=function(){for(var s={key:"T",ref:S,"aria-describedby":Ce.current},x=Array.isArray(R)?R:[R],m=0,L=x.length;m<L;m++)switch(x[m]){case"click":s.onClick=J;break;case"right-click":s.onContextMenu=ht;break;case"hover":s.onMouseEnter=H,s.onMouseLeave=G;break;case"focus":s.onFocus=H,s.onBlur=G;break}if(typeof r=="function"){var M=r(C);return!!r&&i.cloneElement(M,s)}return!!r&&i.cloneElement(r,s)},xt=function(){var s=g?_.popupContent.modal:_.popupContent.tooltip,x={className:"popup-content "+(T!==""?T.split(" ").map(function(m){return m+"-content"}).join(" "):""),style:$({},s,it,{pointerEvents:"auto"}),ref:w,onClick:function(L){L.stopPropagation()}};return!fe&&R.indexOf("hover")>=0&&(x.onMouseEnter=H,x.onMouseLeave=G),x},Se=function(){return i.createElement("div",Object.assign({},xt(),{key:"C",role:g?"dialog":"tooltip",id:Ce.current}),K&&!g&&i.createElement("div",{ref:N,style:_.popupArrow},i.createElement("svg",{"data-testid":"arrow",className:"popup-arrow "+(T!==""?T.split(" ").map(function(s){return s+"-arrow"}).join(" "):""),viewBox:"0 0 32 16",style:$({position:"absolute"},q)},i.createElement("path",{d:"M16 0l16 16H0z",fill:"currentcolor"}))),U&&typeof U=="function"?U(A,C):U)},wt=!(R.indexOf("hover")>=0),gt=g?_.overlay.modal:_.overlay.tooltip,jt=[wt&&i.createElement("div",{key:"O","data-testid":"overlay","data-popup":g?"modal":"tooltip",className:"popup-overlay "+(T!==""?T.split(" ").map(function(y){return y+"-overlay"}).join(" "):""),style:$({},gt,at,{pointerEvents:k&&j||g?"auto":"none"}),onClick:k&&j?A:void 0,tabIndex:-1},g&&Se()),!g&&Se()];return i.createElement(i.Fragment,null,bt(),C&&Q.createPortal(jt,ze()))});function Ye(e){const[t,o]=X(),r=e.onClose;e.onClose=()=>{r&&r(),o()},t.render(n.jsx(Fe,{...e}))}function Fe({title:e,message:t,onClose:o}){return n.jsxs(F,{position:"center center",open:!0,onClose:o,className:"versioning-popup",children:[n.jsx("header",{children:e}),n.jsx("main",{children:t}),n.jsx("footer",{children:n.jsx("button",{onClick:o,children:"Close"})})]})}function X(){const e=document.createElement("div");document.body.appendChild(e);const t=te.createRoot(e);return[t,()=>{t.unmount(),e.remove()}]}function oe(e){return async t=>{t.preventDefault();try{await e()}catch(o){Ye({title:"Error",message:o.message})}}}async function Xe(e){const t=await e.json();if(qe(t)&&t.status!==200)throw new Error(t.message);return t}function qe(e){return typeof e=="object"&&"status"in e&&"message"in e}async function ne(e,t){const o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.setAttribute("download",t),r.click(),URL.revokeObjectURL(o)}async function Ke(){KNOWWE.editCommons.showAjaxLoader();const e=await fetch("action/CreateSnapshotAction");if(KNOWWE.editCommons.hideAjaxLoader(),e.status!==200){const t=await e.json();throw new Error(t.message)}window.location.reload()}async function Je(e,t,o){KNOWWE.editCommons.showAjaxLoader();let r;if(t==="ATTACHMENT"?r=await fetch(`action/DeployAttachmentSnapshotAction?deploy_file=${e}&KWiki_Topic=${o}`):r=await fetch(`action/DeployRepoSnapshotAction?deploy_file=${e}`),KNOWWE.editCommons.hideAjaxLoader(),r.status!==200){const l=await r.json();throw new Error(l.message)}window.location.reload()}async function He(e,t){KNOWWE.editCommons.showAjaxLoader();const o=await fetch(`action/DownloadFileAction?file=${e}&delete=false`);if(await ne(await o.blob(),t+".zip"),KNOWWE.editCommons.hideAjaxLoader(),o.status!==200){const r=await o.json();throw new Error(r.message)}}async function Ge(e,t){KNOWWE.editCommons.showAjaxLoader();const o=await fetch(`action/DownloadFileAction?file=${e}&delete=true`);if(await ne(await o.blob(),t+".zip"),KNOWWE.editCommons.hideAjaxLoader(),o.status!==200){const r=await o.json();throw new Error(r.message)}window.location.reload()}function re(e){const[t,o]=X();t.render(n.jsx(Qe,{...e,unmount:o}))}function Qe({snapshotName:e,snapshotPageName:t,snapshotType:o,unmount:r}){return n.jsx(F,{position:"center center",open:!0,onClose:r,className:"snapshots-popup",children:n.jsxs("form",{children:[n.jsx("header",{children:"Delete Snapshot"}),n.jsxs("main",{children:[n.jsxs("div",{children:["Are you sure you want to deploy ",n.jsx("b",{children:e}),"?"]}),n.jsxs("footer",{children:[n.jsx("button",{className:"",onClick:oe(()=>Je(e+".zip",o,t)),children:"Deploy"}),n.jsx("button",{onClick:r,children:"Cancel"})]})]})]})})}function Ve(e){const[t,o]=X();t.render(n.jsx(Ze,{...e,unmount:o}))}function Ze({snapshotPath:e,snapshotName:t,unmount:o}){return n.jsx(F,{position:"center center",open:!0,onClose:o,className:"snapshots-popup",children:n.jsxs("form",{children:[n.jsx("header",{children:"Delete Snapshot"}),n.jsxs("main",{children:[n.jsxs("div",{children:["Are you sure you want to delete ",n.jsx("b",{children:t}),"?"]}),n.jsxs("footer",{children:[n.jsx("button",{className:"btn-danger",onClick:oe(()=>Ge(e,t)),children:"Delete"}),n.jsx("button",{onClick:o,children:"Cancel"})]})]})]})})}function Be(){const[e,t]=i.useState(),[o,r]=i.useState();return i.useEffect(()=>{fetch("action/ListSnapshotsAction").then(Xe).then(t).catch(r)},[]),n.jsxs("table",{className:"snapshots-table",style:{marginTop:"1rem"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Name"}),n.jsx("th",{children:"Action"})]})}),n.jsxs("tbody",{children:[o&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,children:o.message})}),!e&&!o&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,children:n.jsx("div",{className:"versioning-spinner"})})}),!o&&e&&e.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,children:"No Snapshots yet."})}),!o&&e&&e.length>0&&e.map(l=>n.jsxs("tr",{children:[n.jsx("td",{title:l.path,children:l.name}),n.jsx("td",{children:l.type==="ATTACHMENT"?n.jsx(et,{snapshot:l}):n.jsx(tt,{snapshot:l})})]}))]})]})}function et({snapshot:e}){return n.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[n.jsx("button",{className:"btn btn-default",title:"Deploy this snapshot to the wiki",onClick:()=>re({snapshotName:e.name,snapshotType:e.type,snapshotPageName:e.parent}),children:"Deploy"}),n.jsx("a",{href:"Upload.jsp?page="+e.parent,children:n.jsx("button",{className:"btn btn-default",title:"Open a list of all attachments for this page",children:"Open"})})]})}function tt({snapshot:e}){return n.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[n.jsx("button",{className:"btn btn-default",title:"Deploy this snapshot to the wiki",onClick:()=>re({snapshotName:e.name,snapshotType:e.type,snapshotPageName:e.parent}),children:"Deploy"}),n.jsx("button",{className:"btn btn-default",title:"Download this snapshot",onClick:()=>He(e.path,e.name),children:"Download"}),n.jsx("button",{className:"btn btn-default",title:"Delete this snapshot from the wiki permanently",onClick:()=>Ve({snapshotPath:e.path,snapshotName:e.name}),children:"Delete"})]})}function ot(e){te.createRoot(e).render(n.jsx(nt,{}))}function nt(){const t=new URLSearchParams(window.location.search).get("page")||"";return n.jsxs("div",{className:"snapshots-panel",children:[n.jsx("h3",{children:"Snapshot Testing Panel"}),n.jsx("hr",{}),n.jsx("button",{className:"btn btn-default",onClick:Ke,children:"Create Snapshot"}),n.jsx("a",{href:"Upload.jsp?page="+t,children:n.jsx("button",{className:"btn btn-default",children:"Upload Snapshot"})}),n.jsx(Be,{})]})}jq$(()=>{jq$("[data-name='SnapshotControlPanel'] .markupText").each((e,t)=>ot(t))})})(React,ReactDOM);
