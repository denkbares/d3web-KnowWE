(function(i,Q){"use strict";var V=document.createElement("style");V.textContent=`.snapshots-panel{display:inline-block;padding:1rem;min-width:35rem}.snapshots-panel h3{padding:0;margin:0}.snapshots-panel h5{font-size:1.05rem;font-weight:600;margin:0}.snapshots-panel .buttons{margin-bottom:1rem}.snapshots-panel .snapshots-table .buttons{display:flex;flex-direction:row}.snapshots-panel .snapshots-table{margin:.75rem 0}.snapshots-panel .upload-button{display:inline-block;position:relative;margin:2px 2px 0}.snapshots-panel input[type=file]{position:absolute;top:0;right:0;width:100%;height:100%;opacity:0;font-size:0;cursor:pointer}.popup-content{margin:auto;background:#fff;width:50%;padding:5px;border:1px solid #d7d7d7}[role=tooltip].popup-content{width:200px;box-shadow:0 0 3px #00000029;border-radius:5px}.popup-overlay{background:#00000080}[data-popup=tooltip].popup-overlay{background:transparent}.snapshots-popup-content{width:auto;max-width:640px;padding:0;border-radius:.125rem}.snapshots-popup-content header{margin:0;padding:.5rem 1rem;font-weight:700;color:var(--text-color-default-head);background-color:var(--bg-color-table-th-highlighted)}.snapshots-popup-content main{padding:1rem 2rem .5rem}.snapshots-popup-content form{display:flex;flex-direction:column;font-size:.9rem}.snapshots-popup-content footer{margin-top:1rem;display:flex;flex-direction:row;justify-content:center;gap:.5rem}.snapshots-popup-content button{font-size:.9rem}.snapshots-popup-content button[disabled]{color:gray}.snapshots-popup-content .btn-danger{color:var(--text-color-error)}.snapshots-popup-content ul{margin:0}.snapshots-popup-content input{margin-left:.5rem}.snapshots-table{border:1px solid #ddd;border-collapse:collapse;border-spacing:0;width:100%}.snapshots-table td{text-align:left;padding:8px;border:1px solid #000000}.snapshots-table th{border:1px solid #000000}.snapshots-table th:last-child{width:1px;white-space:nowrap}.snapshots-table td:last-child{text-align:center;cursor:pointer}.snapshots-table thead tr:first-child{background-color:#bbb}.snapshots-table tbody tr:nth-child(2n){background-color:#f2f2f2}.snapshots-table button{padding:.125rem .5rem}
/*$vite$:1*/`,document.head.appendChild(V);var K={exports:{}},W={};var Z;function Pe(){if(Z)return W;Z=1;var t=i,e=Symbol.for("react.element"),o=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,u=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(y,a,c){var l,h={},v=null,f=null;c!==void 0&&(v=""+c),a.key!==void 0&&(v=""+a.key),a.ref!==void 0&&(f=a.ref);for(l in a)r.call(a,l)&&!d.hasOwnProperty(l)&&(h[l]=a[l]);if(y&&y.defaultProps)for(l in a=y.defaultProps,a)h[l]===void 0&&(h[l]=a[l]);return{$$typeof:e,type:y,key:v,ref:f,props:h,_owner:u.current}}return W.Fragment=o,W.jsx=p,W.jsxs=p,W}var B;function Le(){return B||(B=1,K.exports=Pe()),K.exports}var n=Le(),M={},ee;function Ne(){if(ee)return M;ee=1;var t=Q;return M.createRoot=t.createRoot,M.hydrateRoot=t.hydrateRoot,M}var te=Ne();function T(){return T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},T.apply(this,arguments)}var De=function(e,o){o===void 0&&(o=!0),i.useEffect(function(){if(o){var r=function(d){d.key==="Escape"&&e(d)};return document.addEventListener("keyup",r),function(){o&&document.removeEventListener("keyup",r)}}},[e,o])},We=function(e,o){o===void 0&&(o=!0),i.useEffect(function(){if(o){var r=function(){e()};return window.addEventListener("resize",r),function(){o&&window.removeEventListener("resize",r)}}},[e,o])},Te=function(e,o,r){r===void 0&&(r=!0),i.useEffect(function(){if(r){var u=function(p){var y=Array.isArray(e)?e:[e],a=!1;y.forEach(function(c){if(!c.current||c.current.contains(p.target)){a=!0;return}}),p.stopPropagation(),a||o(p)};return document.addEventListener("mousedown",u),document.addEventListener("touchstart",u),function(){r&&(document.removeEventListener("mousedown",u),document.removeEventListener("touchstart",u))}}},[e,o,r])},$e=function(e,o){o===void 0&&(o=!0),i.useEffect(function(){if(o){var r=function(d){if(d.keyCode===9){var p,y=e==null||(p=e.current)===null||p===void 0?void 0:p.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),a=Array.prototype.slice.call(y);if(a.length===1){d.preventDefault();return}var c=a[0],l=a[a.length-1];d.shiftKey&&document.activeElement===c?(d.preventDefault(),l.focus()):document.activeElement===l&&(d.preventDefault(),c.focus())}};return document.addEventListener("keydown",r),function(){o&&document.removeEventListener("keydown",r)}}},[e,o])},_e=typeof window<"u"?i.useLayoutEffect:i.useEffect,$={popupContent:{tooltip:{position:"absolute",zIndex:999},modal:{position:"relative",margin:"auto"}},popupArrow:{height:"8px",width:"16px",position:"absolute",background:"transparent",color:"#FFF",zIndex:-1},overlay:{tooltip:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",zIndex:999},modal:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",display:"flex",zIndex:999}}},Re=["top left","top center","top right","right top","right center","right bottom","bottom left","bottom center","bottom right","left top","left center","left bottom"],ze=function(e,o,r,u,d){var p=d.offsetX,y=d.offsetY,a=u?8:0,c=r.split(" "),l=e.top+e.height/2,h=e.left+e.width/2,v=o.height,f=o.width,E=l-v/2,j=h-f/2,A="",C="0%",O="0%";switch(c[0]){case"top":E-=v/2+e.height/2+a,A="rotate(180deg)  translateX(50%)",C="100%",O="50%";break;case"bottom":E+=v/2+e.height/2+a,A="rotate(0deg) translateY(-100%) translateX(-50%)",O="50%";break;case"left":j-=f/2+e.width/2+a,A=" rotate(90deg)  translateY(50%) translateX(-25%)",O="100%",C="50%";break;case"right":j+=f/2+e.width/2+a,A="rotate(-90deg)  translateY(-150%) translateX(25%)",C="50%";break}switch(c[1]){case"top":E=e.top,C=e.height/2+"px";break;case"bottom":E=e.top-v+e.height,C=v-e.height/2+"px";break;case"left":j=e.left,O=e.width/2+"px";break;case"right":j=e.left-f+e.width,O=f-e.width/2+"px";break}return E=c[0]==="top"?E-y:E+y,j=c[0]==="left"?j-p:j+p,{top:E,left:j,transform:A,arrowLeft:O,arrowTop:C}},Me=function(e){var o={top:0,left:0,width:window.innerWidth,height:window.innerHeight};if(typeof e=="string"){var r=document.querySelector(e);r!==null&&(o=r.getBoundingClientRect())}return o},Ie=function(e,o,r,u,d,p){var y=d.offsetX,a=d.offsetY,c={arrowLeft:"0%",arrowTop:"0%",left:0,top:0,transform:"rotate(135deg)"},l=0,h=Me(p),v=Array.isArray(r)?r:[r];for((p||Array.isArray(r))&&(v=[].concat(v,Re));l<v.length;){c=ze(e,o,v[l],u,{offsetX:y,offsetY:a});var f={top:c.top,left:c.left,width:o.width,height:o.height};if(f.top<=h.top||f.left<=h.left||f.top+f.height>=h.top+h.height||f.left+f.width>=h.left+h.width)l++;else break}return c},Ue=0,Ke=function(){var e=document.getElementById("popup-root");return e===null&&(e=document.createElement("div"),e.setAttribute("id","popup-root"),document.body.appendChild(e)),e},F=i.forwardRef(function(t,e){var o=t.trigger,r=o===void 0?null:o,u=t.onOpen,d=u===void 0?function(){}:u,p=t.onClose,y=p===void 0?function(){}:p,a=t.defaultOpen,c=a===void 0?!1:a,l=t.open,h=l===void 0?void 0:l,v=t.disabled,f=v===void 0?!1:v,E=t.nested,j=E===void 0?!1:E,A=t.closeOnDocumentClick,C=A===void 0?!0:A,O=t.repositionOnResize,it=O===void 0?!0:O,ie=t.closeOnEscape,at=ie===void 0?!0:ie,ae=t.on,_=ae===void 0?["click"]:ae,le=t.contentStyle,lt=le===void 0?{}:le,ue=t.arrowStyle,Y=ue===void 0?{}:ue,ce=t.overlayStyle,ut=ce===void 0?{}:ce,de=t.className,D=de===void 0?"":de,pe=t.position,ct=pe===void 0?"bottom center":pe,fe=t.modal,he=fe===void 0?!1:fe,me=t.lockScroll,ve=me===void 0?!1:me,be=t.arrow,q=be===void 0?!0:be,ye=t.offsetX,dt=ye===void 0?0:ye,xe=t.offsetY,pt=xe===void 0?0:xe,we=t.mouseEnterDelay,ft=we===void 0?100:we,ge=t.mouseLeaveDelay,ht=ge===void 0?100:ge,je=t.keepTooltipInside,mt=je===void 0?!1:je,I=t.children,Ee=i.useState(h||c),k=Ee[0],Ce=Ee[1],S=i.useRef(null),w=i.useRef(null),L=i.useRef(null),ke=i.useRef(null),Oe=i.useRef("popup-"+ ++Ue),g=he?!0:!r,R=i.useRef(0);_e(function(){return k?(ke.current=document.activeElement,Se(),xt(),bt()):yt(),function(){clearTimeout(R.current)}},[k]),i.useEffect(function(){typeof h=="boolean"&&(h?U():P())},[h,f]);var U=function(s){k||f||(Ce(!0),setTimeout(function(){return d(s)},0))},P=function(s){var x;!k||f||(Ce(!1),g&&((x=ke.current)===null||x===void 0||x.focus()),setTimeout(function(){return y(s)},0))},J=function(s){s==null||s.stopPropagation(),k?P(s):U(s)},H=function(s){clearTimeout(R.current),R.current=setTimeout(function(){return U(s)},ft)},vt=function(s){s==null||s.preventDefault(),J()},G=function(s){clearTimeout(R.current),R.current=setTimeout(function(){return P(s)},ht)},bt=function(){g&&ve&&(document.getElementsByTagName("body")[0].style.overflow="hidden")},yt=function(){g&&ve&&(document.getElementsByTagName("body")[0].style.overflow="auto")},xt=function(){var s,x=w==null||(s=w.current)===null||s===void 0?void 0:s.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),m=Array.prototype.slice.call(x)[0];m==null||m.focus()};i.useImperativeHandle(e,function(){return{open:function(){U()},close:function(){P()},toggle:function(){J()}}});var Se=function(){if(!(g||!k)&&!(!(S!=null&&S.current)||!(S!=null&&S.current)||!(w!=null&&w.current))){var s=S.current.getBoundingClientRect(),x=w.current.getBoundingClientRect(),m=Ie(s,x,ct,q,{offsetX:dt,offsetY:pt},mt);if(w.current.style.top=m.top+window.scrollY+"px",w.current.style.left=m.left+window.scrollX+"px",q&&L.current){var N,z;L.current.style.transform=m.transform,L.current.style.setProperty("-ms-transform",m.transform),L.current.style.setProperty("-webkit-transform",m.transform),L.current.style.top=((N=Y.top)===null||N===void 0?void 0:N.toString())||m.arrowTop,L.current.style.left=((z=Y.left)===null||z===void 0?void 0:z.toString())||m.arrowLeft}}};De(P,at),$e(w,k&&g),We(Se,it),Te(r?[w,S]:[w],P,C&&!j);var wt=function(){for(var s={key:"T",ref:S,"aria-describedby":Oe.current},x=Array.isArray(_)?_:[_],m=0,N=x.length;m<N;m++)switch(x[m]){case"click":s.onClick=J;break;case"right-click":s.onContextMenu=vt;break;case"hover":s.onMouseEnter=H,s.onMouseLeave=G;break;case"focus":s.onFocus=H,s.onBlur=G;break}if(typeof r=="function"){var z=r(k);return!!r&&i.cloneElement(z,s)}return!!r&&i.cloneElement(r,s)},gt=function(){var s=g?$.popupContent.modal:$.popupContent.tooltip,x={className:"popup-content "+(D!==""?D.split(" ").map(function(m){return m+"-content"}).join(" "):""),style:T({},s,lt,{pointerEvents:"auto"}),ref:w,onClick:function(N){N.stopPropagation()}};return!he&&_.indexOf("hover")>=0&&(x.onMouseEnter=H,x.onMouseLeave=G),x},Ae=function(){return i.createElement("div",Object.assign({},gt(),{key:"C",role:g?"dialog":"tooltip",id:Oe.current}),q&&!g&&i.createElement("div",{ref:L,style:$.popupArrow},i.createElement("svg",{"data-testid":"arrow",className:"popup-arrow "+(D!==""?D.split(" ").map(function(s){return s+"-arrow"}).join(" "):""),viewBox:"0 0 32 16",style:T({position:"absolute"},Y)},i.createElement("path",{d:"M16 0l16 16H0z",fill:"currentcolor"}))),I&&typeof I=="function"?I(P,k):I)},jt=!(_.indexOf("hover")>=0),Et=g?$.overlay.modal:$.overlay.tooltip,Ct=[jt&&i.createElement("div",{key:"O","data-testid":"overlay","data-popup":g?"modal":"tooltip",className:"popup-overlay "+(D!==""?D.split(" ").map(function(b){return b+"-overlay"}).join(" "):""),style:T({},Et,ut,{pointerEvents:C&&j||g?"auto":"none"}),onClick:C&&j?P:void 0,tabIndex:-1},g&&Ae()),!g&&Ae()];return i.createElement(i.Fragment,null,wt(),k&&Q.createPortal(Ct,Ke()))});function oe(t){const[e,o]=X(),r=t.onClose;t.onClose=()=>{r&&r(),o()},e.render(n.jsx(Fe,{...t}))}function Fe({title:t,message:e,onClose:o}){return n.jsxs(F,{position:"center center",open:!0,onClose:o,className:"versioning-popup",children:[n.jsx("header",{children:t}),n.jsx("main",{children:e}),n.jsx("footer",{children:n.jsx("button",{onClick:o,children:"Close"})})]})}function X(){const t=document.createElement("div");document.body.appendChild(t);const e=te.createRoot(t);return[e,()=>{e.unmount(),t.remove()}]}function ne(t){return async e=>{e.preventDefault();try{await t()}catch(o){oe({title:"Error",message:o.message})}}}async function Xe(t){const e=await t.json();if(Ye(e)&&e.status!==200)throw new Error(e.message);return e}function Ye(t){return typeof t=="object"&&"status"in t&&"message"in t}async function re(t,e){const o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.setAttribute("download",e),r.click(),URL.revokeObjectURL(o)}async function qe(){KNOWWE.editCommons.showAjaxLoader();const t=await fetch("action/CreateSnapshotAction");if(KNOWWE.editCommons.hideAjaxLoader(),t.status!==200){const e=await t.json();throw new Error(e.message)}window.location.reload()}async function Je(t){KNOWWE.editCommons.showAjaxLoader();let e=await fetch(`action/DeploySnapshotAction?deploy_file=${t}`);if(KNOWWE.editCommons.hideAjaxLoader(),e.status!==200){const o=await e.json();throw new Error(o.message)}window.location.reload()}async function He(t,e){KNOWWE.editCommons.showAjaxLoader();const o=await fetch(`action/DownloadFileAction?file=${t}&delete=false`);if(await re(await o.blob(),e+".zip"),KNOWWE.editCommons.hideAjaxLoader(),o.status!==200){const r=await o.json();throw new Error(r.message)}}async function Ge(t){KNOWWE.editCommons.showAjaxLoader();const e=new FormData;e.append("file",t);const o=await fetch(`action/UploadSnapshotAction?X-XSRF-TOKEN=${Wiki.CsrfProtection}`,{method:"POST",body:e});if(KNOWWE.editCommons.hideAjaxLoader(),o.status!==200){const r=await o.json();throw new Error(r.message)}}async function Qe(t,e){KNOWWE.editCommons.showAjaxLoader();const o=await fetch(`action/DownloadFileAction?file=${t}&delete=true`);if(await re(await o.blob(),e+".zip"),KNOWWE.editCommons.hideAjaxLoader(),o.status!==200){const r=await o.json();throw new Error(r.message)}window.location.reload()}function Ve(t){const[e,o]=X();e.render(n.jsx(Ze,{...t,unmount:o}))}function Ze({snapshotName:t,unmount:e}){return n.jsx(F,{position:"center center",open:!0,onClose:e,className:"snapshots-popup",children:n.jsxs("form",{children:[n.jsx("header",{children:"Delete Snapshot"}),n.jsxs("main",{children:[n.jsxs("div",{children:["Are you sure you want to deploy ",n.jsx("b",{children:t}),"?"]}),n.jsxs("footer",{children:[n.jsx("button",{onClick:ne(()=>Je(t+".zip")),children:"Deploy"}),n.jsx("button",{onClick:e,children:"Cancel"})]})]})]})})}function Be(t){const[e,o]=X();e.render(n.jsx(et,{...t,unmount:o}))}function et({snapshotPath:t,snapshotName:e,unmount:o}){return n.jsx(F,{position:"center center",open:!0,onClose:o,className:"snapshots-popup",children:n.jsxs("form",{children:[n.jsx("header",{children:"Delete Snapshot"}),n.jsxs("main",{children:[n.jsxs("div",{children:["Are you sure you want to delete ",n.jsx("b",{children:e}),"?"]}),n.jsxs("footer",{children:[n.jsx("button",{className:"btn-danger",onClick:ne(()=>Qe(t,e)),children:"Delete"}),n.jsx("button",{onClick:o,children:"Cancel"})]})]})]})})}function tt(){const[t,e]=i.useState(),[o,r]=i.useState();return i.useEffect(()=>{fetch("action/ListSnapshotsAction").then(Xe).then(e).catch(r)},[]),o?n.jsx("div",{children:n.jsx("p",{children:o.message})}):n.jsxs("div",{children:[!t&&n.jsx("div",{children:n.jsx("div",{className:"versioning-spinner"})}),t&&t.length===0&&n.jsx("p",{children:"No Snapshots yet."}),t&&t.length>0&&n.jsxs("div",{children:[n.jsx(se,{snapshots:t,filter:u=>!u.name.startsWith("AutosaveSnapshot")}),n.jsx("h5",{children:"Autosaves"}),n.jsx(se,{snapshots:t,filter:u=>u.name.startsWith("AutosaveSnapshot")})]})]})}function se({snapshots:t,filter:e}){return n.jsxs("table",{className:"snapshots-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Name"}),KNOWWE.core.util.isAdmin()==="true"?n.jsx("th",{children:"Action"}):""]})}),n.jsx("tbody",{children:t.length>0&&t.filter(o=>e?e(o):o).map(o=>n.jsxs("tr",{children:[n.jsx("td",{title:o.name+".zip",children:o.name}),KNOWWE.core.util.isAdmin()==="true"?n.jsx("td",{children:n.jsx(ot,{snapshot:o})}):""]}))})]})}function ot({snapshot:t}){const e=(t.size/1048576).toFixed(2);return n.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[n.jsx("button",{className:"btn btn-default",title:"Deploy this snapshot to the wiki",onClick:()=>Ve({snapshotName:t.name}),children:"Deploy"}),n.jsx("button",{className:"btn btn-default",title:`Download this snapshot (${e} MB)`,onClick:()=>He(t.path,t.name),children:"Download"}),n.jsx("button",{className:"btn btn-default",title:`Delete
                this snapshot from the wiki permanently (
                ${e}
                MB
                )`,onClick:()=>Be({snapshotPath:t.path,snapshotName:t.name}),children:"Delete"})]})}function nt(t){te.createRoot(t).render(n.jsx(rt,{}))}function rt(){return n.jsxs("div",{className:"snapshots-panel",children:[KNOWWE.core.util.isAdmin()==="true"?n.jsxs("div",{className:"buttons",children:[n.jsx("button",{className:"btn btn-default",onClick:qe,children:"Create Snapshot"}),n.jsxs("div",{className:"upload-button",children:[n.jsx("label",{className:"btn btn-default",children:"Upload Snapshot"}),n.jsx("input",{type:"file",name:"file",onChange:st})]})]}):"",n.jsx(tt,{})]})}async function st(t){try{const e=t.target;if(typeof e.files>"u"||!e.files||e.files.length===0)return;const o=e.files[0];await Ge(o),window.location.reload()}catch(e){oe({title:"Error",message:e.message})}}jq$(()=>{jq$("[data-name='SnapshotControlPanel'] .markupText").each((t,e)=>nt(e))})})(React,ReactDOM);
